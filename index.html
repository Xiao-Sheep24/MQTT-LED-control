<!DOCTYPE html>
<html>
<head>
  <title>ESP32 LED æ§åˆ¶é¢æ¿</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    button { margin: 5px; padding: 10px; font-size: 16px; }
    #log {
      margin-top: 20px;
      font-family: monospace;
      white-space: pre-wrap;
      border: 1px solid #ccc;
      padding: 10px;
      max-height: 250px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>ESP32 å¤šè‰² LED æ§åˆ¶</h2>
  <div>
    <button onclick="controlLED('red', 'on')">ç´…ç‡ˆ ON</button>
    <button onclick="controlLED('red', 'off')">ç´…ç‡ˆ OFF</button><br>
    <button onclick="controlLED('green', 'on')">ç¶ ç‡ˆ ON</button>
    <button onclick="controlLED('green', 'off')">ç¶ ç‡ˆ OFF</button><br>
    <button onclick="controlLED('yellow', 'on')">é»ƒç‡ˆ ON</button>
    <button onclick="controlLED('yellow', 'off')">é»ƒç‡ˆ OFF</button><br>
    <button onclick="controlLED('orange', 'on')">æ©™ç‡ˆ ON</button>
    <button onclick="controlLED('orange', 'off')">æ©™ç‡ˆ OFF</button>
  </div>

  <div id="log"><strong>ğŸ“¬ MQTT è¨Šæ¯å€</strong></div>

  <script>
    const client = mqtt.connect('wss://broker.emqx.io:8084/mqtt', {
      clientId: 'web_' + Math.random().toString(16).substr(2, 8),
      username: 'mqttx_ce657d5d',
      password: ''
    });

    const topic = 'home/yard/ESP32';
    const logDiv = document.getElementById('log');
    const logs = [];

    client.on('connect', () => {
      addLog("âœ… å·²é€£æ¥åˆ° MQTT Broker");
      client.subscribe(topic);
    });

    client.on('message', (topic, payload) => {
      addLog("ğŸ“¥ æ”¶åˆ°: " + payload.toString());
    });

    function controlLED(color, action) {
      const msg = JSON.stringify({ led: color, action: action });
      client.publish(topic, msg, { qos: 1 });
      addLog("ğŸš€ ç™¼é€: " + msg);
    }

    function addLog(text) {
      logs.unshift(text); // æ’å…¥æœ€å‰é¢
      if (logs.length > 10) logs.pop(); // ä¿ç•™ 10 ç­†
      logDiv.innerHTML = "<strong>ğŸ“¬ MQTT è¨Šæ¯å€</strong>\n" + logs.join("\n");
    }
  </script>
</body>
</html>
